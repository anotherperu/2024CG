<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/three@0.137.4/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.137.4/examples/js/controls/OrbitControls.js"></script>
  </head>
<body>
 <script>
       // ページの読み込みを待つ
        window.addEventListener('DOMContentLoaded', init);

        function init() {
          // サイズを指定
            const width = 1200;
            const height = 800;
            // レンダラーを作成
            const renderer = new THREE.WebGLRenderer();
            document.body.appendChild(renderer.domElement);
            renderer.setSize(width, height);

            // シーンを作成
            const scene = new THREE.Scene();

            // カメラを作成
            const camera = new THREE.PerspectiveCamera(45, width / height);
            // カメラの初期座標を設定
            camera.position.set(-2, 4, 5);

            // カメラコントローラーを作成
            const controls = new THREE.OrbitControls(camera, renderer.domElement);

            // 平行光源1
            var directionalLight1 = new THREE.DirectionalLight(0xffffff);
            directionalLight1.position.set(10, 10, 10);
            // シーンに追加
            scene.add(directionalLight1);
            // 平行光源2
            var directionalLight2 = new THREE.DirectionalLight(0x888888);
            directionalLight2.position.set(-10, -10, 10);
            // シーンに追加
            scene.add(directionalLight2);

            // helper
            const gridHelper = new THREE.GridHelper(2, 10); // size, step
            scene.add(gridHelper);
            const axisHelper = new THREE.AxisHelper(2); //軸の長さ　X：赤、Y：緑、z：青
            scene.add(axisHelper);

            // キーボードの土台を作成
            const keyboardBaseGeometry = new THREE.BoxGeometry(18, 1, 10);
            const keyboardBaseMaterial = new THREE.MeshBasicMaterial({ color: 0x33333 });
            const keyboardBase = new THREE.Mesh(keyboardBaseGeometry, keyboardBaseMaterial);
            keyboardBase.position.set(-0.5,0,0);
            scene.add(keyboardBase);

          // マウスパッドを作成
            const mousePadGeometry = new THREE.BoxGeometry(4, 1, 3);
            const mousePadMaterial = new THREE.MeshBasicMaterial({ color: 0xcccccc });
            const mousePad = new THREE.Mesh(mousePadGeometry, mousePadMaterial);
            mousePad.position.set(-0.5,0.1,3);
            scene.add(mousePad);

            // キャンバスを使って文字を含むテクスチャを作成する関数
            function createKeyTexture(letter) {
                const canvas = document.createElement('canvas');
                canvas.width = 256;
                canvas.height = 256;
                const context = canvas.getContext('2d');
                context.fillStyle = 'white';
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = 'black';
                 let fontSize = 150;
                if (letter.length > 1) {
                    fontSize = 55; // 複数文字のキーのフォントサイズを小さくする
                }
                context.font = `${fontSize}px Arial`;
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText(letter, canvas.width / 2, canvas.height / 2);
                return new THREE.CanvasTexture(canvas);
            }

            // キーボードキーを作成する関数
            function createKey(x, y, z, width, height, depth, letter) {
                const keyGeometry = new THREE.BoxGeometry(width, height, depth);
                const keyMaterial = new THREE.MeshBasicMaterial({ map: createKeyTexture(letter) });
                const key = new THREE.Mesh(keyGeometry, keyMaterial);
                key.position.set(x, y, z);
                scene.add(key);
            }

            // キーボードのキーを配置
            const keyWidth = 0.8;
            const keyHeight = 0.8;
            const keyDepth = 0.8;
            const keySpacing = 1.0;
            const layout = [
                ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=', 'Backspace'],
                ['Tab', 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', '[', ']', '\\'],
                ['CapsLock', 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', ';', '\'', 'Enter'],
                ['Shift', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', ',', '.', '/', 'Shift'],
                ['Ctrl', 'Alt', '     ', 'Alt', 'Ctrl']
            ];

            const rowOffsets = [-8, -8, -8, -7.7, -7];
            const rowZPositions = [-3.5, -2.5, -1.5, -0.5, 0.5];

            layout.forEach((row, rowIndex) => {
                let xOffset = rowOffsets[rowIndex];
                row.forEach(key => {
                    let keyWidthScale = 1.0;
                    if ( key === 'Tab' || key === 'Ctrl' || key === 'Backspace'  || key === 'Alt') {
                        keyWidthScale = 2.0;
                    }if ( key === 'CapsLock' || key === 'Enter' || key === 'Shift' ) {
                        keyWidthScale = 2.5;
                    }
                    if (key === '     ') {
                        keyWidthScale = 6.0;
                    }
                    createKey(xOffset + (keyWidthScale / 2), 0.35, rowZPositions[rowIndex], keyWidth * keyWidthScale, keyHeight, keyDepth, key);
                    xOffset += keySpacing * keyWidthScale;
                });
            });

            // レンダリングループ
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
        }
    </script>
</body>
</html>
